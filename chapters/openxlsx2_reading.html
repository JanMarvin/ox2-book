<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3&nbsp; Reading to data frames – The `openxlsx2` book</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/openxlsx2_number_and_string.html" rel="next">
<link href="../chapters/openxlsx2_basic_manual.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-748b535e376f14d4692bf2b2e5fd6380.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1bc3b17e7a2c2828f435aa750fb76336.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-d8997a266dd4c3ddc51b2afa698c8f29.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-1bc3b17e7a2c2828f435aa750fb76336.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/openxlsx2_reading.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reading to data frames</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">The <code>openxlsx2</code> book</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/JanMarvin/ox2-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_basic_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_reading.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reading to data frames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_number_and_string.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Of strings and numbers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_style_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Styling of worksheets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/conditional-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Conditional Formatting, Databars, and Sparklines</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_charts_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Charts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_formulas_manual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Spreadsheet formulas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_pivot_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Pivot tables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_data_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Validation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_form_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Form control</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_clone_and_copy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Cloning and copying</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2-things-with-shapes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Comments and Working with Shapes in openxlsx2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_upgrade_from_openxlsx.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Upgrade from <code>openxlsx</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/openxlsx2_extending.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Extending <code>openxlsx2</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#importing-data" id="toc-importing-data" class="nav-link active" data-scroll-target="#importing-data"><span class="header-section-number">3.1</span> Importing data</a>
  <ul class="collapse">
<li><a href="#basic-import" id="toc-basic-import" class="nav-link" data-scroll-target="#basic-import"><span class="header-section-number">3.1.1</span> Basic import</a></li>
  <li><a href="#col_names---first-row-as-column-name" id="toc-col_names---first-row-as-column-name" class="nav-link" data-scroll-target="#col_names---first-row-as-column-name"><span class="header-section-number">3.1.2</span> <code>col_names</code> - first row as column name</a></li>
  <li><a href="#detect_dates---convert-cells-to-r-dates" id="toc-detect_dates---convert-cells-to-r-dates" class="nav-link" data-scroll-target="#detect_dates---convert-cells-to-r-dates"><span class="header-section-number">3.1.3</span> <code>detect_dates</code> - convert cells to R dates</a></li>
  <li><a href="#show_formula---show-formulas-instead-of-results" id="toc-show_formula---show-formulas-instead-of-results" class="nav-link" data-scroll-target="#show_formula---show-formulas-instead-of-results"><span class="header-section-number">3.1.4</span> <code>show_formula</code> - show formulas instead of results</a></li>
  <li><a href="#dims---read-specific-dimension" id="toc-dims---read-specific-dimension" class="nav-link" data-scroll-target="#dims---read-specific-dimension"><span class="header-section-number">3.1.5</span> <code>dims</code> - read specific dimension</a></li>
  <li><a href="#cols---read-selected-columns" id="toc-cols---read-selected-columns" class="nav-link" data-scroll-target="#cols---read-selected-columns"><span class="header-section-number">3.1.6</span> <code>cols</code> - read selected columns</a></li>
  <li><a href="#rows---read-selected-rows" id="toc-rows---read-selected-rows" class="nav-link" data-scroll-target="#rows---read-selected-rows"><span class="header-section-number">3.1.7</span> <code>rows</code> - read selected rows</a></li>
  <li><a href="#convert---convert-input-to-guessed-type" id="toc-convert---convert-input-to-guessed-type" class="nav-link" data-scroll-target="#convert---convert-input-to-guessed-type"><span class="header-section-number">3.1.8</span> <code>convert</code> - convert input to guessed type</a></li>
  <li><a href="#skip_empty_rows---remove-empty-rows" id="toc-skip_empty_rows---remove-empty-rows" class="nav-link" data-scroll-target="#skip_empty_rows---remove-empty-rows"><span class="header-section-number">3.1.9</span> <code>skip_empty_rows</code> - remove empty rows</a></li>
  <li><a href="#skip_empty_cols---remove-empty-columns" id="toc-skip_empty_cols---remove-empty-columns" class="nav-link" data-scroll-target="#skip_empty_cols---remove-empty-columns"><span class="header-section-number">3.1.10</span> <code>skip_empty_cols</code> - remove empty columns</a></li>
  <li><a href="#row_names---keep-rownames-from-input" id="toc-row_names---keep-rownames-from-input" class="nav-link" data-scroll-target="#row_names---keep-rownames-from-input"><span class="header-section-number">3.1.11</span> <code>row_names</code> - keep rownames from input</a></li>
  <li><a href="#types---convert-column-to-specific-type" id="toc-types---convert-column-to-specific-type" class="nav-link" data-scroll-target="#types---convert-column-to-specific-type"><span class="header-section-number">3.1.12</span> <code>types</code> - convert column to specific type</a></li>
  <li><a href="#start_row---where-to-begin" id="toc-start_row---where-to-begin" class="nav-link" data-scroll-target="#start_row---where-to-begin"><span class="header-section-number">3.1.13</span> <code>start_row</code> - where to begin</a></li>
  <li><a href="#na.strings---define-missing-values" id="toc-na.strings---define-missing-values" class="nav-link" data-scroll-target="#na.strings---define-missing-values"><span class="header-section-number">3.1.14</span> <code>na.strings</code> - define missing values</a></li>
  <li><a href="#importing-as-workbook" id="toc-importing-as-workbook" class="nav-link" data-scroll-target="#importing-as-workbook"><span class="header-section-number">3.1.15</span> Importing as workbook</a></li>
  </ul>
</li>
  <li>
<a href="#example-reading-real-world-data" id="toc-example-reading-real-world-data" class="nav-link" data-scroll-target="#example-reading-real-world-data"><span class="header-section-number">3.2</span> Example: Reading real world data</a>
  <ul class="collapse">
<li><a href="#reading-the-data-table" id="toc-reading-the-data-table" class="nav-link" data-scroll-target="#reading-the-data-table"><span class="header-section-number">3.2.1</span> Reading the data table</a></li>
  <li><a href="#cleaning-the-indents" id="toc-cleaning-the-indents" class="nav-link" data-scroll-target="#cleaning-the-indents"><span class="header-section-number">3.2.2</span> Cleaning the indents</a></li>
  <li><a href="#read-selected-dims" id="toc-read-selected-dims" class="nav-link" data-scroll-target="#read-selected-dims"><span class="header-section-number">3.2.3</span> Read selected dims</a></li>
  <li><a href="#read-data-header-and-body-in-parts" id="toc-read-data-header-and-body-in-parts" class="nav-link" data-scroll-target="#read-data-header-and-body-in-parts"><span class="header-section-number">3.2.4</span> Read data header and body in parts</a></li>
  <li><a href="#bonus-clean-up-this-xlsx-table" id="toc-bonus-clean-up-this-xlsx-table" class="nav-link" data-scroll-target="#bonus-clean-up-this-xlsx-table"><span class="header-section-number">3.2.5</span> Bonus: clean up this xlsx table</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/JanMarvin/ox2-book/edit/main/chapters/openxlsx2_reading.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/JanMarvin/openxlsx2/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reading to data frames</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="importing-data" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="importing-data">
<span class="header-section-number">3.1</span> Importing data</h2>
<p>Coming from <code>openxlsx</code> you might know about <code>read.xlsx()</code> (two functions, one for files and one for workbooks) and <code>readWorkbook()</code>. Functions that do different things, but mostly the same. In <code>openxlsx2</code> we tried our best to reduce the complexity under the hood and for the user as well. In <code>openxlsx2</code> they are replaced with <code>read_xlsx()</code>, <code>wb_read()</code> and they share the same underlying function <code>wb_to_df()</code>.</p>
<p>For this example we will use example data provided by the package. You can locate it in our “inst/extdata” folder. The files are included with the package source and you can open them in any calculation software as well.</p>
<section id="basic-import" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="basic-import">
<span class="header-section-number">3.1.1</span> Basic import</h3>
<p>We begin with the <code>openxlsx2_example.xlsx</code> file by telling R where to find this file on our system</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">xlsxFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"openxlsx2_example.xlsx"</span>, package <span class="op">=</span> <span class="st">"openxlsx2"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The object contains a path to the xlsx file and we pass this file to our function to read the workbook into R</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># import workbook</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1 Var2 &lt;NA&gt;  Var3  Var4       Var5         Var6    Var7     Var8</span></span>
<span><span class="co">#&gt; 3   TRUE    1   NA     1     a 2023-05-29 3209324 This #DIV/0! 01:27:15</span></span>
<span><span class="co">#&gt; 4   TRUE   NA   NA #NUM!     b 2023-05-23         &lt;NA&gt;       0 14:02:57</span></span>
<span><span class="co">#&gt; 5   TRUE    2   NA  1.34     c 2023-02-01         &lt;NA&gt; #VALUE! 23:01:02</span></span>
<span><span class="co">#&gt; 6  FALSE    2   NA  &lt;NA&gt; #NUM!       &lt;NA&gt;         &lt;NA&gt;       2 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE    3   NA  1.56     e       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE    1   NA   1.7     f 2023-03-02         &lt;NA&gt;     2.7 08:45:58</span></span>
<span><span class="co">#&gt; 9     NA   NA   NA  &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 FALSE    2   NA    23     h 2023-12-24         &lt;NA&gt;      25     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE    3   NA  67.3     i 2023-12-25         &lt;NA&gt;       3     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12    NA    1   NA   123  &lt;NA&gt; 2023-07-31         &lt;NA&gt;     122     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output is created as a data frame and contains data types date, logical, numeric and character. The function to import the file to R, <code>wb_to_df()</code> provides similar options as the <code>openxlsx</code> functions <code>read.xlsx()</code> and <code>readWorkbook()</code> and a few new functions we will go through the options. As you might have noticed, we return the column of the xlsx file as the row name of the data frame returned. Per default the first sheet in the workbook is imported. If you want to switch this, either provide the <code>sheet</code> parameter with the correct index or provide the sheet name.</p>
</section><section id="col_names---first-row-as-column-name" class="level3" data-number="3.1.2"><h3 data-number="3.1.2" class="anchored" data-anchor-id="col_names---first-row-as-column-name">
<span class="header-section-number">3.1.2</span> <code>col_names</code> - first row as column name</h3>
<p>In the previous example the first imported row was used as column name for the data frame. This is the default behavior, but not always wanted or expected. Therefore this behavior can be disabled by the user.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># do not convert first row to column names</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;        B    C  D     E     F          G            H       I        J</span></span>
<span><span class="co">#&gt; 2   Var1 Var2 NA  Var3  Var4       Var5         Var6    Var7     Var8</span></span>
<span><span class="co">#&gt; 3   TRUE    1 NA     1     a 2023-05-29 3209324 This #DIV/0! 01:27:15</span></span>
<span><span class="co">#&gt; 4   TRUE &lt;NA&gt; NA #NUM!     b 2023-05-23         &lt;NA&gt;       0 14:02:57</span></span>
<span><span class="co">#&gt; 5   TRUE    2 NA  1.34     c 2023-02-01         &lt;NA&gt; #VALUE! 23:01:02</span></span>
<span><span class="co">#&gt; 6  FALSE    2 NA  &lt;NA&gt; #NUM!       &lt;NA&gt;         &lt;NA&gt;       2 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE    3 NA  1.56     e       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE    1 NA   1.7     f 2023-03-02         &lt;NA&gt;     2.7 08:45:58</span></span>
<span><span class="co">#&gt; 9   &lt;NA&gt; &lt;NA&gt; NA  &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 FALSE    2 NA    23     h 2023-12-24         &lt;NA&gt;      25     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE    3 NA  67.3     i 2023-12-25         &lt;NA&gt;       3     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12  &lt;NA&gt;    1 NA   123  &lt;NA&gt; 2023-07-31         &lt;NA&gt;     122     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="detect_dates---convert-cells-to-r-dates" class="level3" data-number="3.1.3"><h3 data-number="3.1.3" class="anchored" data-anchor-id="detect_dates---convert-cells-to-r-dates">
<span class="header-section-number">3.1.3</span> <code>detect_dates</code> - convert cells to R dates</h3>
<p>The creators of the openxml standard are well known for mistakenly treating something as a date and <code>openxlsx2</code> has built in ways to identify a cell as a date and will try to convert the value for you, but unfortunately this is not always a trivial task and might fail. In such a case we provide an option to disable the date conversion entirely. In this case the underlying numerical value will be returned.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># do not try to identify dates in the data</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, detect_dates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1 Var2 &lt;NA&gt;  Var3  Var4  Var5         Var6    Var7       Var8</span></span>
<span><span class="co">#&gt; 3   TRUE    1   NA     1     a 45075 3209324 This #DIV/0! 0.06059028</span></span>
<span><span class="co">#&gt; 4   TRUE   NA   NA #NUM!     b 45069         &lt;NA&gt;       0 0.58538194</span></span>
<span><span class="co">#&gt; 5   TRUE    2   NA  1.34     c 44958         &lt;NA&gt; #VALUE! 0.95905093</span></span>
<span><span class="co">#&gt; 6  FALSE    2   NA  &lt;NA&gt; #NUM!    NA         &lt;NA&gt;       2 0.72561343</span></span>
<span><span class="co">#&gt; 7  FALSE    3   NA  1.56     e    NA         &lt;NA&gt;    &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt; 8  FALSE    1   NA   1.7     f 44987         &lt;NA&gt;     2.7 0.36525463</span></span>
<span><span class="co">#&gt; 9     NA   NA   NA  &lt;NA&gt;  &lt;NA&gt;    NA         &lt;NA&gt;    &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt; 10 FALSE    2   NA    23     h 45284         &lt;NA&gt;      25         NA</span></span>
<span><span class="co">#&gt; 11 FALSE    3   NA  67.3     i 45285         &lt;NA&gt;       3         NA</span></span>
<span><span class="co">#&gt; 12    NA    1   NA   123  &lt;NA&gt; 45138         &lt;NA&gt;     122         NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="show_formula---show-formulas-instead-of-results" class="level3" data-number="3.1.4"><h3 data-number="3.1.4" class="anchored" data-anchor-id="show_formula---show-formulas-instead-of-results">
<span class="header-section-number">3.1.4</span> <code>show_formula</code> - show formulas instead of results</h3>
<p>Sometimes things might feel off. This can be because the openxml files are not updating formula results in the sheets unless they are opened in software that provides such functionality as certain tabular calculation software. Therefore the user might be interested in the underlying functions to see what is going on in the sheet. Using <code>show_formula</code> this is possible</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># return the underlying Excel formula instead of their values</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, show_formula <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1 Var2 &lt;NA&gt;  Var3  Var4       Var5         Var6            Var7     Var8</span></span>
<span><span class="co">#&gt; 3   TRUE    1   NA     1     a 2023-05-29 3209324 This            E3/0 01:27:15</span></span>
<span><span class="co">#&gt; 4   TRUE   NA   NA #NUM!     b 2023-05-23         &lt;NA&gt;              C4 14:02:57</span></span>
<span><span class="co">#&gt; 5   TRUE    2   NA  1.34     c 2023-02-01         &lt;NA&gt;         #VALUE! 23:01:02</span></span>
<span><span class="co">#&gt; 6  FALSE    2   NA  &lt;NA&gt; #NUM!       &lt;NA&gt;         &lt;NA&gt;           C6+E6 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE    3   NA  1.56     e       &lt;NA&gt;         &lt;NA&gt;            &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE    1   NA   1.7     f 2023-03-02         &lt;NA&gt;           C8+E8 08:45:58</span></span>
<span><span class="co">#&gt; 9     NA   NA   NA  &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;            &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 FALSE    2   NA    23     h 2023-12-24         &lt;NA&gt;    SUM(C10,E10)     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE    3   NA  67.3     i 2023-12-25         &lt;NA&gt; PRODUCT(C11,E3)     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12    NA    1   NA   123  &lt;NA&gt; 2023-07-31         &lt;NA&gt;         E12-C12     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="dims---read-specific-dimension" class="level3" data-number="3.1.5"><h3 data-number="3.1.5" class="anchored" data-anchor-id="dims---read-specific-dimension">
<span class="header-section-number">3.1.5</span> <code>dims</code> - read specific dimension</h3>
<p>Sometimes the entire worksheet contains to much data, in such case we provide functions to read only a selected dimension range. Such a range consists of either a specific cell like “A1” or a cell range in the notion used in the <code>openxml</code> standard</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read dimension without column names</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, dims <span class="op">=</span> <span class="st">"A2:C5"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;    A    B    C</span></span>
<span><span class="co">#&gt; 2 NA Var1 Var2</span></span>
<span><span class="co">#&gt; 3 NA TRUE    1</span></span>
<span><span class="co">#&gt; 4 NA TRUE &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 NA TRUE    2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, if you don’t know the Excel sheet’s address, you can use <code>wb_dims()</code> to specify the dimension. See below or in<code>?wb_dims</code> for more details.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read dimension without column names with `wb_dims()`</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, dims <span class="op">=</span> <span class="fu">wb_dims</span><span class="op">(</span>rows <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;    A    B    C</span></span>
<span><span class="co">#&gt; 2 NA Var1 Var2</span></span>
<span><span class="co">#&gt; 3 NA TRUE    1</span></span>
<span><span class="co">#&gt; 4 NA TRUE &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 NA TRUE    2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="cols---read-selected-columns" class="level3" data-number="3.1.6"><h3 data-number="3.1.6" class="anchored" data-anchor-id="cols---read-selected-columns">
<span class="header-section-number">3.1.6</span> <code>cols</code> - read selected columns</h3>
<p>If you do not want to read a specific cell, but a cell range you can use the column attribute. This attribute takes a numeric vector as argument</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read selected cols</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A:B"</span>, <span class="st">"G"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    &lt;NA&gt;  Var1       Var5</span></span>
<span><span class="co">#&gt; 3    NA  TRUE 2023-05-29</span></span>
<span><span class="co">#&gt; 4    NA  TRUE 2023-05-23</span></span>
<span><span class="co">#&gt; 5    NA  TRUE 2023-02-01</span></span>
<span><span class="co">#&gt; 6    NA FALSE       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7    NA FALSE       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8    NA FALSE 2023-03-02</span></span>
<span><span class="co">#&gt; 9    NA    NA       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10   NA FALSE 2023-12-24</span></span>
<span><span class="co">#&gt; 11   NA FALSE 2023-12-25</span></span>
<span><span class="co">#&gt; 12   NA    NA 2023-07-31</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="rows---read-selected-rows" class="level3" data-number="3.1.7"><h3 data-number="3.1.7" class="anchored" data-anchor-id="rows---read-selected-rows">
<span class="header-section-number">3.1.7</span> <code>rows</code> - read selected rows</h3>
<p>The same goes with rows. You can select them using numeric vectors</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read selected rows</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Var1 Var2 &lt;NA&gt;  Var3  Var4       Var5 Var6 Var7     Var8</span></span>
<span><span class="co">#&gt; 4  TRUE   NA   NA #NUM!     b 2023-05-23   NA    0 14:02:57</span></span>
<span><span class="co">#&gt; 6 FALSE    2   NA  &lt;NA&gt; #NUM!       &lt;NA&gt;   NA    2 17:24:53</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="convert---convert-input-to-guessed-type" class="level3" data-number="3.1.8"><h3 data-number="3.1.8" class="anchored" data-anchor-id="convert---convert-input-to-guessed-type">
<span class="header-section-number">3.1.8</span> <code>convert</code> - convert input to guessed type</h3>
<p>In xml exists no difference between value types. All values are per default characters. To provide these as numerics, logicals or dates, <code>openxlsx2</code> and every other software dealing with xlsx files has to make assumptions about the cell type. This is especially tricky due to the notion of worksheets. Unlike in a data frame, a worksheet can have a wild mix of all types of data. Even though the conversion process from character to date or numeric is rather solid, sometimes the user might want to see the data without any conversion applied. This might be useful in cases where something unexpected happened or the import created warnings. In such a case you can look at the raw input data. If you want to disable date detection as well, please see the entry above.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># convert characters to numerics and date (logical too?)</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, convert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1 Var2 &lt;NA&gt;  Var3  Var4       Var5         Var6    Var7     Var8</span></span>
<span><span class="co">#&gt; 3   TRUE    1 &lt;NA&gt;     1     a 2023-05-29 3209324 This #DIV/0! 01:27:15</span></span>
<span><span class="co">#&gt; 4   TRUE &lt;NA&gt; &lt;NA&gt; #NUM!     b 2023-05-23         &lt;NA&gt;       0 14:02:57</span></span>
<span><span class="co">#&gt; 5   TRUE    2 &lt;NA&gt;  1.34     c 2023-02-01         &lt;NA&gt; #VALUE! 23:01:02</span></span>
<span><span class="co">#&gt; 6  FALSE    2 &lt;NA&gt;  &lt;NA&gt; #NUM!       &lt;NA&gt;         &lt;NA&gt;       2 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE    3 &lt;NA&gt;  1.56     e       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE    1 &lt;NA&gt;   1.7     f 2023-03-02         &lt;NA&gt;     2.7 08:45:58</span></span>
<span><span class="co">#&gt; 9   &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 FALSE    2 &lt;NA&gt;    23     h 2023-12-24         &lt;NA&gt;      25     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE    3 &lt;NA&gt;  67.3     i 2023-12-25         &lt;NA&gt;       3     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12  &lt;NA&gt;    1 &lt;NA&gt;   123  &lt;NA&gt; 2023-07-31         &lt;NA&gt;     122     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="skip_empty_rows---remove-empty-rows" class="level3" data-number="3.1.9"><h3 data-number="3.1.9" class="anchored" data-anchor-id="skip_empty_rows---remove-empty-rows">
<span class="header-section-number">3.1.9</span> <code>skip_empty_rows</code> - remove empty rows</h3>
<p>Even though <code>openxlsx2</code> imports everything as requested, sometimes it might be helpful to remove empty lines from the data. These might be either left empty intentional or empty because they are were formatted, but the cell value was removed afterwards. This was added mostly for backward comparability, but the default has been changed to <code>FALSE</code>. The behavior has changed a bit as well. Previously empty cells were removed prior to the conversion to R data frames, now they are removed after the conversion and are removed only if they are completely empty</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># erase empty rows from dataset</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="fl">1</span>, skip_empty_rows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1 Var2 &lt;NA&gt; Var3  Var4       Var5 Var6 Var7     Var8</span></span>
<span><span class="co">#&gt; 6  FALSE    2   NA &lt;NA&gt; #NUM!       &lt;NA&gt; &lt;NA&gt;    2 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE    3   NA 1.56     e       &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE    1   NA  1.7     f 2023-03-02 &lt;NA&gt;  2.7 08:45:58</span></span>
<span><span class="co">#&gt; 10 FALSE    2   NA   23     h 2023-12-24 &lt;NA&gt;   25     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE    3   NA 67.3     i 2023-12-25 &lt;NA&gt;    3     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12    NA    1   NA  123  &lt;NA&gt; 2023-07-31 &lt;NA&gt;  122     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="skip_empty_cols---remove-empty-columns" class="level3" data-number="3.1.10"><h3 data-number="3.1.10" class="anchored" data-anchor-id="skip_empty_cols---remove-empty-columns">
<span class="header-section-number">3.1.10</span> <code>skip_empty_cols</code> - remove empty columns</h3>
<p>The same for columns</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># erase empty columns from dataset</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, skip_empty_cols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1 Var2  Var3  Var4       Var5         Var6    Var7     Var8</span></span>
<span><span class="co">#&gt; 3   TRUE    1     1     a 2023-05-29 3209324 This #DIV/0! 01:27:15</span></span>
<span><span class="co">#&gt; 4   TRUE   NA #NUM!     b 2023-05-23         &lt;NA&gt;       0 14:02:57</span></span>
<span><span class="co">#&gt; 5   TRUE    2  1.34     c 2023-02-01         &lt;NA&gt; #VALUE! 23:01:02</span></span>
<span><span class="co">#&gt; 6  FALSE    2  &lt;NA&gt; #NUM!       &lt;NA&gt;         &lt;NA&gt;       2 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE    3  1.56     e       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE    1   1.7     f 2023-03-02         &lt;NA&gt;     2.7 08:45:58</span></span>
<span><span class="co">#&gt; 9     NA   NA  &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 FALSE    2    23     h 2023-12-24         &lt;NA&gt;      25     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE    3  67.3     i 2023-12-25         &lt;NA&gt;       3     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12    NA    1   123  &lt;NA&gt; 2023-07-31         &lt;NA&gt;     122     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="row_names---keep-rownames-from-input" class="level3" data-number="3.1.11"><h3 data-number="3.1.11" class="anchored" data-anchor-id="row_names---keep-rownames-from-input">
<span class="header-section-number">3.1.11</span> <code>row_names</code> - keep rownames from input</h3>
<p>Sometimes the data source might provide rownames as well. In such a case you can <code>openxlsx2</code> to treat the first column as rowname</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># convert first row to rownames</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="fl">2</span>, dims <span class="op">=</span> <span class="st">"C6:G9"</span>, row_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;                mpg cyl disp  hp</span></span>
<span><span class="co">#&gt; Mazda RX4     21.0   6  160 110</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag 21.0   6  160 110</span></span>
<span><span class="co">#&gt; Datsun 710    22.8   4  108  93</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="types---convert-column-to-specific-type" class="level3" data-number="3.1.12"><h3 data-number="3.1.12" class="anchored" data-anchor-id="types---convert-column-to-specific-type">
<span class="header-section-number">3.1.12</span> <code>types</code> - convert column to specific type</h3>
<p>If the user know better than the software what type to expect in a worksheet, this can be provided via types. This parameter takes a named numeric. <code>0</code> is character, <code>1</code> is numeric and <code>2</code> is date</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define type of the data.frame</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>, types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Var1"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"Var3"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1   Var3</span></span>
<span><span class="co">#&gt; 3   TRUE   1.00</span></span>
<span><span class="co">#&gt; 4   TRUE    NaN</span></span>
<span><span class="co">#&gt; 5   TRUE   1.34</span></span>
<span><span class="co">#&gt; 6  FALSE     NA</span></span>
<span><span class="co">#&gt; 7  FALSE   1.56</span></span>
<span><span class="co">#&gt; 8  FALSE   1.70</span></span>
<span><span class="co">#&gt; 9   &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 10 FALSE  23.00</span></span>
<span><span class="co">#&gt; 11 FALSE  67.30</span></span>
<span><span class="co">#&gt; 12  &lt;NA&gt; 123.00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="start_row---where-to-begin" class="level3" data-number="3.1.13"><h3 data-number="3.1.13" class="anchored" data-anchor-id="start_row---where-to-begin">
<span class="header-section-number">3.1.13</span> <code>start_row</code> - where to begin</h3>
<p>Often the creator of the worksheet has used a lot of creativity and the data does not begin in the first row, instead it begins somewhere else. To define the row where to begin reading, define it via the <code>start_row</code> parameter</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># start in row 5</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, start_row <span class="op">=</span> <span class="fl">5</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;        B  C  D      E     F          G  H       I        J</span></span>
<span><span class="co">#&gt; 5   TRUE  2 NA   1.34     c 2023-02-01 NA #VALUE! 23:01:02</span></span>
<span><span class="co">#&gt; 6  FALSE  2 NA     NA #NUM!       &lt;NA&gt; NA       2 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE  3 NA   1.56     e       &lt;NA&gt; NA    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE  1 NA   1.70     f 2023-03-02 NA     2.7 08:45:58</span></span>
<span><span class="co">#&gt; 9     NA NA NA     NA  &lt;NA&gt;       &lt;NA&gt; NA    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 FALSE  2 NA  23.00     h 2023-12-24 NA      25     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE  3 NA  67.30     i 2023-12-25 NA       3     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12    NA  1 NA 123.00  &lt;NA&gt; 2023-07-31 NA     122     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="na.strings---define-missing-values" class="level3" data-number="3.1.14"><h3 data-number="3.1.14" class="anchored" data-anchor-id="na.strings---define-missing-values">
<span class="header-section-number">3.1.14</span> <code>na.strings</code> - define missing values</h3>
<p>There is the “#N/A” string, but often the user will be faced with custom missing values and other values we are not interested. Such strings can be passed as character vector via <code>na.strings</code></p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># na strings</span></span>
<span><span class="fu">wb_to_df</span><span class="op">(</span><span class="va">xlsxFile</span>, na.strings <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Var1 Var2 &lt;NA&gt;  Var3  Var4       Var5         Var6    Var7     Var8</span></span>
<span><span class="co">#&gt; 3   TRUE    1   NA     1     a 2023-05-29 3209324 This #DIV/0! 01:27:15</span></span>
<span><span class="co">#&gt; 4   TRUE   NA   NA #NUM!     b 2023-05-23         &lt;NA&gt;       0 14:02:57</span></span>
<span><span class="co">#&gt; 5   TRUE    2   NA  1.34     c 2023-02-01         &lt;NA&gt; #VALUE! 23:01:02</span></span>
<span><span class="co">#&gt; 6  FALSE    2   NA  &lt;NA&gt; #NUM!       &lt;NA&gt;         &lt;NA&gt;       2 17:24:53</span></span>
<span><span class="co">#&gt; 7  FALSE    3   NA  1.56     e       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8  FALSE    1   NA   1.7     f 2023-03-02         &lt;NA&gt;     2.7 08:45:58</span></span>
<span><span class="co">#&gt; 9     NA   NA   NA  &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 FALSE    2   NA    23     h 2023-12-24         &lt;NA&gt;      25     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 FALSE    3   NA  67.3     i 2023-12-25         &lt;NA&gt;       3     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12    NA    1   NA   123  &lt;NA&gt; 2023-07-31         &lt;NA&gt;     122     &lt;NA&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="importing-as-workbook" class="level3" data-number="3.1.15"><h3 data-number="3.1.15" class="anchored" data-anchor-id="importing-as-workbook">
<span class="header-section-number">3.1.15</span> Importing as workbook</h3>
<p>In addition to importing directly from xlsx or xlsm files, <code>openxlsx2</code> provides the <code>wbWorkbook</code> class used for importing and modifying entire the openxml files in <code>R</code>. This <code>workbook</code> class is the heart of <code>openxlsx2</code> and probably the reason why you are reading this manual in the first place.</p>
<p>Importing a file into a workbook looks like this:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the file we are going to load</span></span>
<span><span class="va">xlsxFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"openxlsx2_example.xlsx"</span>, package <span class="op">=</span> <span class="st">"openxlsx2"</span><span class="op">)</span></span>
<span><span class="co"># loading the file into the workbook</span></span>
<span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu">wb_load</span><span class="op">(</span>file <span class="op">=</span> <span class="va">xlsxFile</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The additional options <code>wb_load()</code> provides are for internal use: <code>sheet</code> loads only a selected sheet from the workbook and <code>data_only</code> reads only the data parts from a workbook and ignores any additional graphics or pivot tables. Both functions create workbook objects that can only be used to read data, and we do not recommend end users to use them. Especially not if they intend to re-export the workbook afterwards.</p>
<p>Once a workbook is imported, we provide several functions to interact with and modify it (the <code>wb_to_df()</code> function mentioned above works the same way for an imported workbook). It is possible to add new sheets and remove sheets, as well as to add or remove data. R-plots can be inserted and also the style of the workbook can be changed, new fonts, background colors and number formats. There is a wealth of options explained in the man pages and the additional style vignette (more vignettes to follow).</p>
</section></section><section id="example-reading-real-world-data" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="example-reading-real-world-data">
<span class="header-section-number">3.2</span> Example: Reading real world data</h2>
<p>In the lines above we have seen various ways how to read data. There is just one downside, actual real world data is usually not as nice and simple as the data we have seen above. Real world data has often features that help us humans to understand and interpret tables, like headlines that span across multiple rows and columns, or descriptions before the data, and footnotes after the data. In addition it is often mixed with totals and subtotals, so even if the data is imported, it still requires a lot of data cleaning. There are ways how <code>openxlsx2</code> can help in this regard. And while not necessarily required, actually looking at the data in a spreadsheet software can help with its understanding.</p>
<p>The file we use is part of the publications from the US Census. “Table 1. Full-Time, Year-Round Workers by Education, Sex, and Detailed Occupation: ACS 2022.” At the time available at: <a href="https://www.census.gov/data/tables/2022/demo/acs-2022.html" class="uri">https://www.census.gov/data/tables/2022/demo/acs-2022.html</a>. The table is rather large with multiple groups in columns and rows. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<section id="reading-the-data-table" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="reading-the-data-table">
<span class="header-section-number">3.2.1</span> Reading the data table</h3>
<p>In a first step we import the entire workbook</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="st">"https://www2.census.gov/programs-surveys/demo/tables/industry-occupation/2022/Detailed_occupation_by_sex_and_education_ACS_2022_tab1.xlsx"</span></span>
<span></span>
<span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu">wb_load</span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the workbook is loaded, we read the entire worksheet and try to get an understanding how it looks like. For this we fill merged cells and remote the column name. After that we can inspect it with <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">wb_to_df</span><span class="op">(</span><span class="va">wb</span>, fill_merged_cells <span class="op">=</span> <span class="cn">TRUE</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span>, skip_empty_cols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># View(df)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using this we realize that the table has a few description rows ahead and a few footnotes below. Numeric data starts in row <code>8</code> and ends in <code>605</code>. The table spans columns <code>A</code> to <code>BG</code>. Therefore our dimensions will look like this <code>A7:BG605</code>. We start one row earlier than the data we want to read, because we expect a column name. In addition there are a few missing values that we want to remove.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="st">"A7:BG605"</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">wb_to_df</span><span class="op">(</span><span class="va">wb</span>, dims <span class="op">=</span> <span class="va">dims</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"**"</span>, <span class="st">"#N/A"</span><span class="op">)</span>, fill_merged_cells <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="cleaning-the-indents" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="cleaning-the-indents">
<span class="header-section-number">3.2.2</span> Cleaning the indents</h3>
<p>Not for every feature there is a custom function, but a lot of things can be done with <code>openxlsx2</code>. The rows are grouped by occupation. This occupation is not visisble in the data frame above. But since the information is available in the data, we can access it.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## adaption of https://github.com/JanMarvin/openxlsx2/discussions/710</span></span>
<span><span class="va">description_dims</span> <span class="op">&lt;-</span> <span class="fu">wb_dims</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">wb_to_df</span><span class="op">(</span><span class="va">wb</span>, dims <span class="op">=</span> <span class="va">description_dims</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">want</span> <span class="op">&lt;-</span> <span class="va">wb</span><span class="op">$</span><span class="fu">get_cell_style</span><span class="op">(</span>dims <span class="op">=</span> <span class="va">description_dims</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the styles for the range</span></span>
<span><span class="va">styles</span> <span class="op">&lt;-</span> <span class="va">wb</span><span class="op">$</span><span class="va">styles_mgr</span><span class="op">$</span><span class="va">styles</span><span class="op">$</span><span class="va">cellXfs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">want</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># now get the indentation alignment from the style</span></span>
<span><span class="va">indents</span> <span class="op">&lt;-</span> <span class="fu">openxlsx2</span><span class="fu">:::</span><span class="fu">read_xf</span><span class="op">(</span><span class="fu">read_xml</span><span class="op">(</span><span class="va">styles</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">indent</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">.</span> <span class="op">==</span> <span class="st">""</span>, <span class="st">"0"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># indent the text</span></span>
<span><span class="va">itext</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">indents</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">indents</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">itmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"__"</span>, <span class="va">indents</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="va">text</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="va">itext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">itext</span>, <span class="va">itmp</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">itext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">itext</span>, <span class="va">text</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># return it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">itext</span>, <span class="fl">10</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total</span></span>
<span><span class="co">#&gt; Management, Business, Science, and Arts Occupations:</span></span>
<span><span class="co">#&gt; __Management, Business, and Financial Occupations:</span></span>
<span><span class="co">#&gt; ____Management Occupations:</span></span>
<span><span class="co">#&gt; ______Chief executives</span></span>
<span><span class="co">#&gt; ______General and operations managers</span></span>
<span><span class="co">#&gt; ______Legislators</span></span>
<span><span class="co">#&gt; ______Advertising and promotions managers</span></span>
<span><span class="co">#&gt; ______Marketing managers</span></span>
<span><span class="co">#&gt; ______Sales managers</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">itext</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">indents</span>   <span class="op">&lt;-</span> <span class="va">indents</span></span>
<span></span>
<span><span class="co"># quite a long list and I am not sure every item has the correct indentation</span></span>
<span><span class="co"># in the spreadsheet</span></span>
<span><span class="va">df_ind1</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">indents</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Estimate"</span>, <span class="st">"MOE2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_ind1</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                     Estimate</span></span>
<span><span class="co">#&gt; __Management, Business, and Financial Occupations:                  22620000</span></span>
<span><span class="co">#&gt; __Computer, Engineering, and Science Occupations:                    9304000</span></span>
<span><span class="co">#&gt; __Education, Legal, Community Service, Arts, and Media Occupations: 11030000</span></span>
<span><span class="co">#&gt; __Chiropractors                                                        43980</span></span>
<span><span class="co">#&gt; __Dentists                                                             96470</span></span>
<span><span class="co">#&gt; __Dietitians and nutritionists                                         70760</span></span>
<span><span class="co">#&gt;                                                                      MOE2</span></span>
<span><span class="co">#&gt; __Management, Business, and Financial Occupations:                  92250</span></span>
<span><span class="co">#&gt; __Computer, Engineering, and Science Occupations:                   74300</span></span>
<span><span class="co">#&gt; __Education, Legal, Community Service, Arts, and Media Occupations: 63890</span></span>
<span><span class="co">#&gt; __Chiropractors                                                      4205</span></span>
<span><span class="co">#&gt; __Dentists                                                           5520</span></span>
<span><span class="co">#&gt; __Dietitians and nutritionists                                       5135</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="read-selected-dims" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="read-selected-dims">
<span class="header-section-number">3.2.3</span> Read selected dims</h3>
<p>Lets say you have opened the file in a spreadsheet software and identified a few cells that you want to read. You don’t want to read every cell, only a few occupations, and total estimates for man and woman. Basically you have decided, that you want to import the cells with yellow highlighting in the following screenshot.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="../img/read_dims_1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Since your output contains non consecutive cells, which are basically a square, you can pass them as a single <code>dims</code> string. In the <code>dims</code> string we treat header and column differently. We can check with <code>dims_to_dataframe("A6:B6,D6,H6,A12:B17,D12:D17,H12:H17", fill = TRUE, empty_rm = TRUE)</code> if our <code>dims</code> object works. Since we see no blanks, every cell is matched.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">wb_to_df</span><span class="op">(</span></span>
<span>  <span class="va">wb</span>, </span>
<span>  dims <span class="op">=</span> <span class="st">"A6:B6,D6,H6,A12:B17,D12:D17,H12:H17"</span>,</span>
<span>  fill_merged_cells <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                  Occupational Category   Total   Men   Women</span></span>
<span><span class="co">#&gt; 12                    Chief executives 1289000 915800 373400</span></span>
<span><span class="co">#&gt; 13     General and operations managers 1104000 727700 376300</span></span>
<span><span class="co">#&gt; 14                         Legislators   11090   6505   4585</span></span>
<span><span class="co">#&gt; 15 Advertising and promotions managers   46220  20360  25860</span></span>
<span><span class="co">#&gt; 16                  Marketing managers  512500 200600 311900</span></span>
<span><span class="co">#&gt; 17                      Sales managers  510400 352900 157500</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And another table, this time without a separate header row.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="../img/read_dims_2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>To read the orange cells, the following command can be used:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">wb_to_df</span><span class="op">(</span></span>
<span>  <span class="va">wb</span>,</span>
<span>  dims <span class="op">=</span> <span class="st">"A7:A8,L7:M8,P7:Q8"</span>,</span>
<span>  fill_merged_cells <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   Occupational Category Estimate   MOE2 Estimate   MOE2</span></span>
<span><span class="co">#&gt; 8                 Total 58140000 156600 34950000 103100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="read-data-header-and-body-in-parts" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="read-data-header-and-body-in-parts">
<span class="header-section-number">3.2.4</span> Read data header and body in parts</h3>
<p>Using only the last row right above the data, can result in many duplicated column names. It is not always possible to avoid this, but sometimes it is possible to create a unique name combining the multiple header rows. In the code below, we read two <code>df</code> objects, the <code>df_head</code> and the <code>df_body</code>. Once the data is imported, it is straightforward to modify the <code>df_head</code> object to create a unique column name.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read body</span></span>
<span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="st">"A8:BG605"</span></span>
<span><span class="va">df_body</span> <span class="op">&lt;-</span> <span class="fu">wb_to_df</span><span class="op">(</span><span class="va">wb</span>, dims <span class="op">=</span> <span class="va">dims</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"**"</span>, <span class="st">"#N/A"</span><span class="op">)</span>, fill_merged_cells <span class="op">=</span> <span class="cn">TRUE</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read header</span></span>
<span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="st">"A5:BG7"</span></span>
<span><span class="va">df_head</span> <span class="op">&lt;-</span> <span class="fu">wb_to_df</span><span class="op">(</span><span class="va">wb</span>, dims <span class="op">=</span> <span class="va">dims</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"**"</span>, <span class="st">"#N/A"</span><span class="op">)</span>, fill_merged_cells <span class="op">=</span> <span class="cn">TRUE</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create single header string. remove all spaces, unique values. collapse on dot</span></span>
<span><span class="va">nams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_head</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[ \t\r\n]"</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">df_head</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, <span class="cn">NA_character_</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check that names in body and head match</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_body</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">nams</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign names and create output object, avoid duplicates</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">df_body</span>, <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">nams</span>, unique <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a few names of the workbook</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Occupational_Category"        "Total.Estimate"              </span></span>
<span><span class="co">#&gt;  [3] "Total.MOE2"                   "Total.Men.Estimate"          </span></span>
<span><span class="co">#&gt;  [5] "Total.Men.MOE2"               "Total.Men.Percent_of_Total"  </span></span>
<span><span class="co">#&gt;  [7] "Total.Men.MOE2.1"             "Total.Women.Estimate"        </span></span>
<span><span class="co">#&gt;  [9] "Total.Women.MOE2"             "Total.Women.Percent_of_Total"</span></span>
<span></span>
<span><span class="co"># a glimpse of the new object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                   Occupational_Category Total.Estimate</span></span>
<span><span class="co">#&gt; 8                                                 Total      102800000</span></span>
<span><span class="co">#&gt; 9  Management, Business, Science, and Arts Occupations:       49810000</span></span>
<span><span class="co">#&gt; 10     Management, Business, and Financial Occupations:       22620000</span></span>
<span><span class="co">#&gt; 11                              Management Occupations:       15080000</span></span>
<span><span class="co">#&gt; 12                                     Chief executives        1289000</span></span>
<span><span class="co">#&gt; 13                      General and operations managers        1104000</span></span>
<span><span class="co">#&gt;    Total.MOE2 Total.Men.Estimate Total.Men.MOE2</span></span>
<span><span class="co">#&gt; 8      138800           57980000          90250</span></span>
<span><span class="co">#&gt; 9      160000           25080000         106700</span></span>
<span><span class="co">#&gt; 10      92250           12310000          63260</span></span>
<span><span class="co">#&gt; 11      73430            8828000          54810</span></span>
<span><span class="co">#&gt; 12      21490             915800          20110</span></span>
<span><span class="co">#&gt; 13      18650             727700          14240</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given enough knowledge about certain data files, it is often possible to identify cells, similar to <code>VLOOKUP()</code> in spreadsheets. In our case, we could maybe make use of e.g.&nbsp;<code>which(df$A == "Total")</code> or <code>int2col(which(df[6, ] == "Men"))</code>. But such cases require a bit more hand tailored solutions. From experience the most important thing is to remain doubtful about the data imported. There are many things that can go wrong, like picking the wrong column, or the wrong spreadsheet. Don’t be shy to check your work against spreadsheet software. Again and again.</p>
</section><section id="bonus-clean-up-this-xlsx-table" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="bonus-clean-up-this-xlsx-table">
<span class="header-section-number">3.2.5</span> Bonus: clean up this xlsx table</h3>
<p>Obviously something is wrong in the xlsx file. We have already worked with the data, so lets see if we can clean it up.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fix some broken indentation in the file - this is only to please my OCD</span></span>
<span><span class="va">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq.int</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">text</span> <span class="op">==</span> <span class="st">"Healthcare Practitioners and Technical Occupations:"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">text</span> <span class="op">==</span> <span class="st">"Other healthcare practitioners and technical occupations"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">indents</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">indents</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span></span>
<span><span class="va">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq.int</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">text</span> <span class="op">==</span> <span class="st">"Healthcare Practitioners and Technical Occupations:"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1L</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">text</span> <span class="op">==</span> <span class="st">"Other production workers"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">indents</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">indents</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span></span>
<span><span class="va">create_groups</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sequence</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Create a data frame</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Index <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sequence</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">sequence</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate Supergroup, Group, and Subgroup identifiers</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">Supergroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">Group</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">Subgroup</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Fill NA values for non-group entries</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">Supergroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">df</span><span class="op">$</span><span class="va">Supergroup</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">Group</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">df</span><span class="op">$</span><span class="va">Group</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">Subroup</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">df</span><span class="op">$</span><span class="va">Group</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html">fill</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">Supergroup</span>, <span class="va">Group</span>, <span class="va">Subgroup</span>, .direction <span class="op">=</span> <span class="st">"down"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">Index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">&lt;-</span> <span class="va">indents</span></span>
<span></span>
<span><span class="co"># each duplicated MOE2 is a percent value</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span>, y <span class="op">=</span> <span class="fu">create_groups</span><span class="op">(</span><span class="va">indents</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Index"</span>, <span class="st">"Value"</span><span class="op">)</span>, sort <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Value</span> <span class="op">==</span> <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Occupational_Category"</span>, <span class="st">"Total.Estimate"</span>, <span class="st">"Total.MOE2"</span>, <span class="st">"Supergroup"</span>, <span class="st">"Group"</span>, <span class="st">"Subgroup"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">Total.Estimate</span> <span class="op">~</span> <span class="va">Supergroup</span>, data <span class="op">=</span> <span class="va">tab</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Supergroup Total.Estimate</span></span>
<span><span class="co">#&gt; 1          2      102819245</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">Total.Estimate</span> <span class="op">~</span> <span class="va">Group</span>, data <span class="op">=</span> <span class="va">tab</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Group Total.Estimate</span></span>
<span><span class="co">#&gt; 1     1       22622315</span></span>
<span><span class="co">#&gt; 2     2        9304335</span></span>
<span><span class="co">#&gt; 3     3       11029725</span></span>
<span><span class="co">#&gt; 4     4        6853765</span></span>
<span><span class="co">#&gt; 5     5       11841230</span></span>
<span><span class="co">#&gt; 6     6       18861045</span></span>
<span><span class="co">#&gt; 7     7        9240130</span></span>
<span><span class="co">#&gt; 8     8        6044450</span></span>
<span><span class="co">#&gt; 9     9        7022250</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>A backup of the file can be found here <a href="https://janmarvin.github.io/openxlsx-data/Detailed_occupation_by_sex_and_education_ACS_2022_tab1.xlsx" class="uri">https://janmarvin.github.io/openxlsx-data/Detailed_occupation_by_sex_and_education_ACS_2022_tab1.xlsx</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/janmarvin\.github\.io\/ox2-book\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/openxlsx2_basic_manual.html" class="pagination-link" aria-label="Basics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/openxlsx2_number_and_string.html" class="pagination-link" aria-label="Of strings and numbers">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Of strings and numbers</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/JanMarvin/ox2-book/edit/main/chapters/openxlsx2_reading.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/JanMarvin/openxlsx2/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>